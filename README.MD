# Инфраструктура

Задание выполнено с минимальными требованиями.
Если у проверяющего есть возможность отложить проверку моей работу на пару дней - буду очень признателен, т.к. хочется поработать с докером.

В папке server - находится билд сервер
В папке build - находится билд агент

Задания на сборку отправляются раз в 30 сек при наличии билдов в очереди (можно еще добавить функционал - "проверять очередь и ставить на сборку при добавлении нового агента или окончании работы агента на старым билдом").
Когда агент прекращает работу, мы это регистрируем, и в следующем цикле при наличии очереди отправляем ему билд
Агент при ошибки клонирования репозитория или чекаута отправляет на сервер лог с сообщение ошибки и статус failed (можно еще добавить фичу на сервер - проверка с определенным интервалом очереди агентов по времени их запуска ).
Агент останавливается если при старте не смог соединиться с сервером.
Агент настроено 4 попытки отправить информацию на сервер при помощи библиотеки axios-retry.

# Тесты

Для тестирование сервера применялись модульные тесты.
Использовались следующие библиотеки:

- supertest
- jest

Модульными тестами проверялись ответы и часть сайд эффектов ручек апи.
Также проверялись некоторые мидллвары и вспомогательные функции.

Для клиентской части использовались интеграционные тесты.
Использовались следующие библиотеки:

- hermione
- selenium

К сожалению, не на все пользовательские сценарии успел покрыть интеграционные тестами.

Для тестов использовались api заглушки.

- shri-api-stub - для интеграционных тестов
- shri-api-test - для модульных тестов

В hri-api-stub написан не очень элегантный, но рабочий костыль для восстановления данных сервера при тестировании.

## Модульные тесты

Для запуска необходимо добавить в папку /config файл с наименованием test.js, следующего содержания:

```
{
  "jwt": // токен от шри api,
  "port": 5000, // Обязательно 5000
  "github-token": // не обязательно, но github без токена позволяет делать только 60 запросов в час
}
```

Запуск тестов

```
npm run test
```

### Интеграционные тесты

Для запуска необходимо добавить в папку /config файл с наименованием stub.js, следующего содержания:

```
{
  "jwt": // токен от шри api,
  "port": 5000, // Обязательно 5000
  "github-token": // не обязательно, но github без токена позволяет делать только 60 запросов в час
}
```

Запуск тестов
Сеты тестов (для разных браузеров) обязательно запускать раздельно, т.к. изменяются данные на stub сервере. По этой причине могут прийти неверные данные в браузер, запущенный паралельно.

```
selenium-standalone start

npm run server:stub

npm run hermione -- --set firefox
npm run hermione -- --set chrome
```

## Версия Node.js

"node": "^12.13.0"
"npm": "^6.12"

Для запуска необходимо добавить в папку /config файл с наименованием local.js, следующего содержания:

```
{
  "jwt": // токен от шри api,
  "port": 5000, // Обязательно 5000
  "github-token": // не обязательно, но github без токена позволяет делать только 60 запросов в час
}
```

## запуск

```
npm start
```
